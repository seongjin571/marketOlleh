<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
        <%= title %>
    </title>
    <meta name="viewport" content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'>
    <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/coupon.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.3.3/css/swiper.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>
    <script src="/javascripts/spin.js"></script>
    <script type='application/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js'></script>
    <!-- <script>
        window.addEventListener('load', function () {
            FastClick.attach(document.body);
        }, false); -->
    </script>
</head>

<body>
    <div id="menu">
        <div id="go_my_coupon">내 쿠폰</div>
        <div id="go_coupon_view">쿠폰 보기</div>
    </div>


    <div id="coupon_view">
        <h2 id="good_market_list">
            내가 가는 시장들
        </h2>



      <% if(result2) { %>
        <% var count =0; %>
        <% for(var j=0; j<result2.length; j++) { %>
          <% for(var k=j ;k<result2.length; k++) { %>
            <% if(result2[j].sijang_name == result2[k].sijang_name) { %>
              <% count++; %>
              <% } %>
        <% } %>
        <% if(count == 1) { %>
          <div class="market" id="market_name_id"name="sijang_name">
              <p id="click_coupon" class="click_coupon"value="<%= result2[j].sijang_name %>"><%= result2[j].sijang_name %></p>
              <% if(cou_result) {%>

              <% } %>
          </div>

        <% } %>
        <% count =0; %>
        <% } %>


       <% } else { %>
            <p>비어있음</p>
        <% } %>


                                                                <h2 id="near_market_list">
                                                                    주변 시장들
                                                                </h2>

                                                                <div class="market">
                                                                    <p>통인 시장</p>
                                                                </div>
                                                                <div class="market">
                                                                    <p>서울관광 시장</p>
                                                                </div>
                                                                <div class="market">
                                                                    <p>모란 시장</p>
                                                                </div>
    </div>



    <div class="my_coupon">
        <% if(result1) { %>
            <% for(var i=0; i<result1.length; i++) { %>
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide content">
                            <div class="store_and_market">
                                <div class="store_name">
                                    <%= result1[i].market_name %>
                                </div>
                                <div class="market_name">
                                    <%= result1[i].sijang_name %>
                                </div>
                            </div>
                            <div class="sale_price">
                                <%= result1[i].coupon_reward %>
                            </div>
                            <div class="standard">
                                <%= result1[i].coupon_standard %>
                            </div>
                            <div class="period">
                                <%= result1[i].coupon_count %>
                            </div>
                        </div>
                        <div class="swiper-slide menu">삭제</div>
                    </div>
                    <% } %>
                        <% } else { %>
                            <div class='stamp_list'>
                                <div id="no_stamp">발급받은 쿠폰이 없습니다.</div>
                            </div>
                            <% } %>
                </div>

    </div>



    <div id="nav_sj">
        <div id="home_sj">
            <img src="/images/home.png" width="40%">
            <p>홈</p>
        </div>
        <div id="coupon_sj">
            <img src="/images/coupon2.png" width="40%">
            <p id="nav_text">쿠폰</p>
        </div>
        <div id="location_sj">
            <img src="/images/location.png" width="40%">
            <p>주변 가맹점</p>
        </div>
        <div id="myStamp_sj">
            <img src="/images/stamp.png" width="40%">
            <p>내 스탬프</p>
        </div>
        <div id="logout">
            <img src="/images/logout.png" width="40%">
            <p>로그아웃</p>
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.3.3/js/swiper.min.js"></script>
<script>

    $('#go_my_coupon').click(function () {
        $('#coupon_view').hide(200);
        $('.my_coupon').show(200);
    })
    $('#go_coupon_view').click(function () {
        $('#coupon_view').show(200);
        $('.my_coupon').hide(200);
    })
    $('#myStamp_sj').click(function () {
        location.href = "/myStamp";
    })
    $('#home_sj').click(function () {
        location.href = "/main";
    })
    $('#logout').click(function () {
            var logout = confirm("로그아웃 하시겠습니까?");
            if (logout == true) {
              console.log('로그아웃성공');
              $(location).attr('href','/logout');

            } else {
              console.log('로그아웃실패');
            }
        })
    var swiper = new Swiper('.swiper-container', {
        slidesPerView: 'auto',
        initialSlide: 0,
        resistanceRatio: 0.5,
        slideToClickedSlide: true,
    });



    var next_index = 0;
    var index=-1;
    var count=0;
    $('.market').click(function () {
        next_index = $(this).index();
        if(next_index ==index){
            if(count==1){
            $('.find_coupon_list1').remove();
            index=next_index;
            count=0;
            }
            else{
                var sijang_name=document.getElementsByClassName('click_coupon')[next_index-1].innerHTML;
        var data={
          'sijang_name' : sijang_name
        }

        $.ajax({
          type : 'post',
          url : '/send_sijang_name',
          contentType: "application/x-www-form-urlencoded; charset=UTF-8",
          cache: false,
          data: data,
          datatype: "json",
          success : function(result) {
            if(result['result']=='success'){
              var coupon_name = result['results'];
              console.log(coupon_name);
              if(coupon_name.length){
                for(var i =0; i<coupon_name.length;i++){
                  var find_coupon_list_div = document.createElement("div");
                  find_coupon_list_div.setAttribute("class","find_coupon_list1");


                  var html = '<div class="find_coupon1" style="background-color : skyblue;margin : 30px;">';
                      html += '<div class="store_and_market1">';
                      html += '<div class="store_name1">'+coupon_name[i].market_name +'</div>';
                      html += '<div class="market_name1">'+coupon_name[i].sijang_name+'</div>';
                      html += '<div class="sale_price1">'+coupon_name[i].coupon_reward+'</div>';
                      html += '<div class="standard1">'+coupon_name[i].coupon_standard+'</div>';
                      html += '<div class="period1">'+coupon_name[i].coupon_count+'</div>';
                      html += '</div>';
                      html += '</div>';


                  find_coupon_list_div.innerHTML = html;
                  document.getElementsByClassName('market')[next_index-1].appendChild(find_coupon_list_div)
                  index=next_index;
                  count=1;
                }

              }else{
                alert('해당 시장에 쿠폰이 없습니다.');
              }
            }
          }
        })
            }
        }
        else{
            $('.find_coupon_list1').remove();
        var sijang_name=document.getElementsByClassName('click_coupon')[next_index-1].innerHTML;
        var data={
          'sijang_name' : sijang_name
        }

        $.ajax({
          type : 'post',
          url : '/send_sijang_name',
          contentType: "application/x-www-form-urlencoded; charset=UTF-8",
          cache: false,
          data: data,
          datatype: "json",
          success : function(result) {
            if(result['result']=='success'){
              var coupon_name = result['results'];
              console.log(coupon_name);
              if(coupon_name.length){
                for(var i =0; i<coupon_name.length;i++){
                  var find_coupon_list_div = document.createElement("div");
                  find_coupon_list_div.setAttribute("class","find_coupon_list1");


                  var html = '<div class="find_coupon1" style="background-color : skyblue;margin : 30px;">';
                      html += '<div class="store_and_market1">';
                      html += '<div class="store_name1">'+coupon_name[i].market_name +'</div>';
                      html += '<div class="market_name1">'+coupon_name[i].sijang_name+'</div>';
                      html += '<div class="sale_price1">'+coupon_name[i].coupon_reward+'</div>';
                      html += '<div class="standard1">'+coupon_name[i].coupon_standard+'</div>';
                      html += '<div class="period1">'+coupon_name[i].coupon_count+'</div>';
                      html += '</div>';
                      html += '</div>';


                  find_coupon_list_div.innerHTML = html;
                  document.getElementsByClassName('market')[next_index-1].after(find_coupon_list_div)
                  index=next_index;
                  count=1;
                }

              }else{
                alert('해당 시장에 쿠폰이 없습니다.');
              }
            }
          }
        })
    }
    })

    $('.find_coupon_list1').click(function () {
        alert('a')
        var list = $(this).index()-1;
        var market=document.getElementsByClassName('store_name1')[list];
        var market_name =market.innerHTML;
        down();
        function down() {
            if (confirm(list + '번째 쿠폰을 다운로드 하시겠습니까?')) {

                alert(market_name + '번째 쿠폰 다운로드 완료')
            } else {
            }
        }
    })


</script>

</html>
