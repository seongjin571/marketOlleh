{"version":3,"sources":["index.js"],"names":["name","verbose","version","root","resolve","appName","basename","packageToInstall","getInstallPackage","packageName","getPackageName","checkAppName","mkdir","isSafeToCreateProjectIn","console","log","process","exit","packageJson","private","writeFile","join","chdir","packageManagerCmd","packageManagerType","run","createApp","install","code","command","args","error","checkNodeVersion","scriptsPath","cwd","init","require","packageJsonPath","JSON","readFile","parse","engines","node","satisfies","red","validFiles","readdir","indexOf","file","every","argv","slice","commands","_","packageManager","length","then","userHasYarn","result","sync","stdio","status","e","defaultType","supportedTypes","t","find","type","callback","cmd","push","concat","validSemver","valid","installPackage","matches","match","Error","charAt","substr","split","allDependencies","cyan","map","depName"],"mappings":"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","file":"index.js","sourcesContent":["\n\n// @flow\n\n// DON'T MODIFY THIS FILE\n// IF AT ALL POSSIBLE, MAKE ANY CHANGES IN THE SCRIPTS PACKAGE\n\nimport fse from 'fs-extra';\nimport chalk from 'chalk';\nimport minimist from 'minimist';\nimport path from 'path';\nimport pathExists from 'path-exists';\nimport semver from 'semver';\nimport spawn from 'cross-spawn';\n\nconst argv = minimist(process.argv.slice(2));\n\n/**\n * Arguments:\n *   --version - to print current version\n *   --verbose - to print npm logs during init\n *   --scripts-version <alternative package>\n *   --package-manager <package manager name or path>\n *     Example of valid values:\n *     - a specific npm version: \"0.22.0-rc1\"\n *     - a .tgz archive from npm: \"https://registry.npmjs.org/react-native-scripts/-/react-native-scripts-0.20.0.tgz\"\n *     - a package from `tasks/clean_pack.sh`: \"/home/adam/create-react-native-app/react-native-scripts-0.22.0.tgz\"\n */\nconst commands = argv._;\nconst cwd = process.cwd();\nconst packageManager = argv['package-manager'];\n\nif (commands.length === 0) {\n  if (argv.version) {\n    const version = require('../package.json').version;\n    console.log(`create-react-native-app version: ${version}`);\n    process.exit();\n  }\n  console.error('Usage: create-react-native-app <project-directory> [--verbose]');\n  process.exit(1);\n}\n\ncreateApp(commands[0], !!argv.verbose, argv['scripts-version']).then(() => {});\n\nfunction userHasYarn() {\n  try {\n    const result = spawn.sync('yarnpkg', ['--version'], { stdio: 'ignore' });\n    if (result.error || result.status !== 0) {\n      return false;\n    }\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n// This decides the 'interface' of the package managing command.\n// Ex: If it guesses the type of package manager as 'yarn',\n//     then it executes '(yarn) add' command instead of '(npm) install'.\nfunction packageManagerType() {\n  const defaultType = 'npm';\n  const supportedTypes = ['yarn', 'npm'];\n\n  if (packageManager) {\n    let t = supportedTypes.find(type => {\n      return packageManager.indexOf(type) > -1;\n    });\n    return t ? t : defaultType;\n  }\n\n  return userHasYarn() ? 'yarn' : defaultType;\n}\n\nfunction packageManagerCmd() {\n  if (packageManager) {\n    return packageManager;\n  } else {\n    return packageManagerType() === 'yarn' ? 'yarnpkg' : 'npm';\n  }\n}\n\nasync function createApp(name: string, verbose: boolean, version: ?string): Promise<void> {\n  const root = path.resolve(name);\n  const appName = path.basename(root);\n\n  const packageToInstall = getInstallPackage(version);\n  const packageName = getPackageName(packageToInstall);\n  checkAppName(appName, packageName);\n\n  if (!await pathExists(name)) {\n    await fse.mkdir(root);\n  } else if (!await isSafeToCreateProjectIn(root)) {\n    console.log(`The directory \\`${name}\\` contains file(s) that could conflict. Aborting.`);\n    process.exit(1);\n  }\n\n  console.log(`Creating a new React Native app in ${root}.`);\n  console.log();\n\n  const packageJson = {\n    name: appName,\n    version: '0.1.0',\n    private: true,\n  };\n  await fse.writeFile(path.join(root, 'package.json'), JSON.stringify(packageJson, null, 2));\n  process.chdir(root);\n\n  console.log(\n    `Using package manager as ${packageManagerCmd()} with ${packageManagerType()} interface.`\n  );\n  console.log('Installing packages. This might take a couple minutes.');\n  console.log('Installing react-native-scripts...');\n  console.log();\n\n  await run(root, appName, version, verbose, packageToInstall, packageName);\n}\n\nfunction install(\n  packageToInstall: string,\n  verbose: boolean,\n  callback: (code: number, command: string, args: Array<string>) => Promise<void>\n): void {\n  const type = packageManagerType();\n  let args, result;\n  let cmd = packageManagerCmd();\n\n  if (type === 'yarn') {\n    args = ['add'];\n\n    if (verbose) {\n      args.push('--verbose');\n    }\n\n    args = args.concat(['--dev', '--exact', '--ignore-optional', packageToInstall]);\n    result = spawn.sync(cmd, args, { stdio: 'inherit' });\n  } else {\n    args = ['install'];\n\n    if (verbose) {\n      args.push('--verbose');\n    }\n    args = args.concat(['--save-dev', '--save-exact', packageToInstall]);\n\n    result = spawn.sync(cmd, args, { stdio: 'inherit' });\n  }\n\n  callback(result.status, cmd, args).then(\n    () => {},\n    e => {\n      throw e;\n    }\n  );\n}\n\nasync function run(\n  root: string,\n  appName: string,\n  version: ?string,\n  verbose: boolean,\n  packageToInstall: string,\n  packageName: string\n): Promise<void> {\n  install(packageToInstall, verbose, async (code: number, command: string, args: Array<string>) => {\n    if (code !== 0) {\n      console.error(`\\`${command} ${args.join(' ')}\\` failed`);\n      return;\n    }\n\n    await checkNodeVersion(packageName);\n\n    const scriptsPath = path.resolve(\n      process.cwd(),\n      'node_modules',\n      packageName,\n      'build',\n      'scripts',\n      'init.js'\n    );\n\n    // $FlowFixMe (dikaiosune) maybe there's a way to convince flow this is legit?\n    const init = require(scriptsPath);\n    await init(root, appName, verbose, cwd);\n  });\n}\n\nfunction getInstallPackage(version: ?string): string {\n  let packageToInstall = 'react-native-scripts';\n  const validSemver = semver.valid(version);\n  if (validSemver) {\n    packageToInstall += `@${validSemver}`;\n  } else if (version) {\n    // for tar.gz or alternative paths\n    packageToInstall = version;\n  }\n  return packageToInstall;\n}\n\n// Extract package name from tarball url or path.\nfunction getPackageName(installPackage: string): string {\n  if (installPackage.indexOf('.tgz') > -1) {\n    // The package name could be with or without semver version, e.g. react-scripts-0.2.0-alpha.1.tgz\n    // However, this function returns package name only wihout semver version.\n    const matches = installPackage.match(/^.+[\\/\\\\](.+?)(?:-\\d+.+)?\\.tgz$/);\n    if (matches && matches.length >= 2) {\n      return matches[1];\n    } else {\n      throw new Error(\n        `Provided scripts package (${installPackage}) doesn't have a valid filename.`\n      );\n    }\n  } else if (installPackage.indexOf('@') > 0) {\n    // Do not match @scope/ when stripping off @version or @tag\n    return installPackage.charAt(0) + installPackage.substr(1).split('@')[0];\n  }\n  return installPackage;\n}\n\nasync function checkNodeVersion(packageName: string): Promise<void> {\n  const packageJsonPath = path.resolve(process.cwd(), 'node_modules', packageName, 'package.json');\n\n  const packageJson = JSON.parse(await fse.readFile(packageJsonPath));\n  if (!packageJson.engines || !packageJson.engines.node) {\n    return;\n  }\n\n  if (!semver.satisfies(process.version, packageJson.engines.node)) {\n    console.error(\n      chalk.red(\n        'You are currently running Node %s but create-react-native-app requires %s.' +\n          ' Please use a supported version of Node.\\n'\n      ),\n      process.version,\n      packageJson.engines.node\n    );\n    process.exit(1);\n  }\n}\n\nfunction checkAppName(appName: string, packageName: string): void {\n  const allDependencies = [\n    'react-native-scripts',\n    'exponent',\n    'expo',\n    'vector-icons',\n    'react',\n    'react-native',\n  ];\n\n  if (allDependencies.indexOf(appName) >= 0) {\n    console.error(\n      chalk.red(\n        'We cannot create a project called `' +\n          appName +\n          '` because a dependency with the same name exists.\\n' +\n          'Due to the way npm works, the following names are not allowed:\\n\\n'\n      ) +\n        chalk.cyan(\n          allDependencies\n            .map(depName => {\n              return '  ' + depName;\n            })\n            .join('\\n')\n        ) +\n        chalk.red('\\n\\nPlease choose a different project name.')\n    );\n    process.exit(1);\n  }\n}\n\n// If project only contains files generated by GH, it’s safe\nasync function isSafeToCreateProjectIn(root: string): Promise<boolean> {\n  const validFiles = ['.DS_Store', 'Thumbs.db', '.git', '.gitignore', 'README.md', 'LICENSE'];\n  return (await fse.readdir(root)).every(file => {\n    return validFiles.indexOf(file) >= 0;\n  });\n}\n"]}